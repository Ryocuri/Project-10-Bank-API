swagger: '2.0'
info:
  title: Documentation API Bank Argent
  description: Contient tous les endpoints API disponibles dans cette base de code
  version: '2.0.0'
  termsOfService: 'http://swagger.io/terms/'
host: localhost:3001
basePath: /api/v1
schemes:
  - http
paths:
  /user/login:
    post:
      tags:
        - Module Utilisateur
      summary: Connexion
      description: API pour la connexion
      parameters:
        - in: body
          name: body
          description: Données de connexion
          required: true
          schema:
            $ref: '#/definitions/Login'
      produces:
        - application/json
      responses:
        '200':
          description: Connexion réussie
          schema:
            $ref: '#/definitions/LoginResponse'
        '400':
          description: Champs invalides
        '500':
          description: Erreur interne du serveur
  /user/signup:
    post:
      tags:
        - Module Utilisateur
      summary: Inscription
      description: API pour l'inscription
      parameters:
        - in: body
          name: body
          description: Données d'inscription
          required: true
          schema:
            $ref: '#/definitions/User'
      produces:
        - application/json
      responses:
        '200':
          description: Inscription réussie
          schema:
            $ref: '#/definitions/ApiResponse'
        '400':
          description: Champs invalides
        '500':
          description: Erreur interne du serveur
  /user/profile:
    post:
      security:
        - Bearer: []
      tags:
        - Module Utilisateur
      summary: API de profil utilisateur
      description: API pour récupérer un profil utilisateur
      parameters:
        - in: header
          name: Authorization
          description: Joindre le token Bearer JWT
          required: true
          type: string
      produces:
        - application/json
      responses:
        '200':
          description: Profil utilisateur récupéré avec succès
          schema:
            $ref: '#/definitions/ApiResponse'
        '400':
          description: Champs invalides
        '401':
          description: Non autorisé
        '500':
          description: Erreur interne du serveur
    put:
      security:
        - Bearer: []
      tags:
        - Module Utilisateur
      summary: API de profil utilisateur
      description: API pour mettre à jour un profil utilisateur
      parameters:
        - in: header
          name: Authorization
          description: Joindre le token Bearer JWT
          required: true
          type: string
        - in: body
          name: body
          description: Mettre à jour les attributs du profil utilisateur
          required: true
          schema:
            $ref: '#/definitions/UserProfile'
      produces:
        - application/json
      responses:
        '200':
          description: Profil utilisateur mis à jour avec succès
          schema:
            $ref: '#/definitions/ApiResponse'
        '400':
          description: Champs invalides
        '401':
          description: Non autorisé
        '500':
          description: Erreur interne du serveur
  /user/accounts:
    get:
      security:
        - Bearer: []
      tags:
        - Module Transactions
      summary: Récupérer tous les comptes utilisateur
      description: |
        Récupère tous les comptes bancaires appartenant à l'utilisateur authentifié. Ce endpoint retourne une liste complète des comptes incluant les comptes courants, comptes d'épargne et cartes de crédit, avec leurs soldes actuels et détails de compte.
        
        **Cas d'usage** : Afficher tous les comptes utilisateur sur la page des transactions, permettant aux utilisateurs de sélectionner le compte dont ils veulent voir les transactions.
        
        **Règles métier** :
        - Retourne uniquement les comptes appartenant à l'utilisateur authentifié
        - Inclut le solde actuel pour chaque compte
        - Retourne les numéros de compte masqués pour la sécurité (ex : x8349)
      parameters:
        - in: header
          name: Authorization
          description: Token Bearer JWT pour l'authentification
          required: true
          type: string
      produces:
        - application/json
      responses:
        '200':
          description: Comptes utilisateur récupérés avec succès
          schema:
            type: object
            properties:
              status:
                type: integer
                example: 200
              message:
                type: string
                example: Comptes récupérés avec succès
              body:
                type: array
                items:
                  $ref: '#/definitions/Account'
          examples:
            application/json:
              status: 200
              message: Comptes récupérés avec succès
              body:
                - accountId: '63f8b8e4d123456789abcdef'
                  accountType: Checking
                  accountName: Argent Bank Compte Courant
                  accountNumber: 'x8349'
                  balance: 2082.79
                  currency: USD
                - accountId: '63f8b8e4d123456789abcd00'
                  accountType: Savings
                  accountName: Argent Bank Épargne
                  accountNumber: 'x6712'
                  balance: 10928.42
                  currency: USD
                - accountId: '63f8b8e4d123456789abcd01'
                  accountType: Credit Card
                  accountName: Argent Bank Carte de Crédit
                  accountNumber: 'x8349'
                  balance: 184.30
                  currency: USD
        '401':
          description: Non autorisé - Token d'authentification invalide ou manquant
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Erreur interne du serveur
          schema:
            $ref: '#/definitions/Error'
  /user/accounts/{accountId}/transactions:
    get:
      security:
        - Bearer: []
      tags:
        - Module Transactions
      summary: Récupérer les transactions du compte
      description: |
        Récupère toutes les transactions pour un compte spécifique pour le mois en cours ou un mois spécifié. Les transactions sont retournées en ordre chronologique inversé (plus récentes en premier) et incluent tous les détails de transaction tels que la date, la description, le montant et le solde courant.
        
        **Cas d'usage** : Afficher toutes les transactions pour un compte sélectionné sur la page des transactions, groupées par mois.
        
        **Règles métier** :
        - Par défaut, retourne les transactions du mois en cours
        - Le paramètre month optionnel permet de visualiser les transactions historiques
        - Retourne uniquement les transactions des comptes appartenant à l'utilisateur authentifié
        - Les transactions incluent le solde courant après chaque transaction
        - Prend en charge la pagination pour les comptes avec beaucoup de transactions
      parameters:
        - in: header
          name: Authorization
          description: Token Bearer JWT pour l'authentification
          required: true
          type: string
        - in: path
          name: accountId
          description: Identifiant unique du compte
          required: true
          type: string
        - in: query
          name: month
          description: Mois au format YYYY-MM (ex. 2024-06). Par défaut le mois en cours si non fourni.
          required: false
          type: string
          pattern: '^\d{4}-\d{2}$'
        - in: query
          name: page
          description: Numéro de page pour la pagination (commence à 1)
          required: false
          type: integer
          minimum: 1
          default: 1
        - in: query
          name: limit
          description: Nombre de transactions par page (max 100)
          required: false
          type: integer
          minimum: 1
          maximum: 100
          default: 20
      produces:
        - application/json
      responses:
        '200':
          description: Transactions récupérées avec succès
          schema:
            type: object
            properties:
              status:
                type: integer
                example: 200
              message:
                type: string
                example: Transactions récupérées avec succès
              body:
                type: object
                properties:
                  account:
                    $ref: '#/definitions/Account'
                  transactions:
                    type: array
                    items:
                      $ref: '#/definitions/Transaction'
                  pagination:
                    type: object
                    properties:
                      currentPage:
                        type: integer
                        example: 1
                      totalPages:
                        type: integer
                        example: 5
                      totalTransactions:
                        type: integer
                        example: 98
                      limit:
                        type: integer
                        example: 20
          examples:
            application/json:
              status: 200
              message: Transactions récupérées avec succès
              body:
                account:
                  accountId: '63f8b8e4d123456789abcdef'
                  accountType: Checking
                  accountName: Argent Bank Compte Courant
                  accountNumber: 'x8349'
                  balance: 2082.79
                  currency: USD
                transactions:
                  - transactionId: '63f8c9a5d123456789abcdef'
                    date: '2020-06-20T10:00:00.000Z'
                    description: Golden Sun Bakery
                    amount: 5.00
                    balance: 2082.79
                    transactionType: Électronique
                    category: Alimentation
                    notes: ''
                  - transactionId: '63f8c9a5d123456789abcd00'
                    date: '2020-06-20T09:30:00.000Z'
                    description: Golden Sun Bakery
                    amount: 10.00
                    balance: 2087.79
                    transactionType: Électronique
                    category: Alimentation
                    notes: ''
                pagination:
                  currentPage: 1
                  totalPages: 1
                  totalTransactions: 2
                  limit: 20
        '400':
          description: Requête incorrecte - Paramètres invalides (ex. format de mois invalide, accountId invalide)
          schema:
            $ref: '#/definitions/Error'
          examples:
            application/json:
              status: 400
              message: Format de mois invalide. Veuillez utiliser le format YYYY-MM.
        '401':
          description: Non autorisé - Token d'authentification invalide ou manquant
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Interdit - L'utilisateur n'a pas accès à ce compte
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Non trouvé - Le compte n'existe pas
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Erreur interne du serveur
          schema:
            $ref: '#/definitions/Error'
  /user/transactions/{transactionId}:
    get:
      security:
        - Bearer: []
      tags:
        - Module Transactions
      summary: Récupérer les détails de la transaction
      description: |
        Récupère les détails complets d'une transaction spécifique. Ce endpoint fournit toutes les informations sur une transaction incluant le type, la catégorie et les notes de l'utilisateur.
        
        **Cas d'usage** : Afficher la vue détaillée d'une transaction quand l'utilisateur développe/clique sur une transaction dans la liste.
        
        **Règles métier** :
        - Retourne uniquement les transactions appartenant aux comptes possédés par l'utilisateur authentifié
        - Inclut toutes les métadonnées de la transaction
        - Retourne les champs éditables par l'utilisateur (catégorie, notes)
      parameters:
        - in: header
          name: Authorization
          description: Token Bearer JWT pour l'authentification
          required: true
          type: string
        - in: path
          name: transactionId
          description: Identifiant unique de la transaction
          required: true
          type: string
      produces:
        - application/json
      responses:
        '200':
          description: Détails de la transaction récupérés avec succès
          schema:
            type: object
            properties:
              status:
                type: integer
                example: 200
              message:
                type: string
                example: Transaction récupérée avec succès
              body:
                $ref: '#/definitions/TransactionDetails'
          examples:
            application/json:
              status: 200
              message: Transaction récupérée avec succès
              body:
                transactionId: '63f8c9a5d123456789abcdef'
                accountId: '63f8b8e4d123456789abcdef'
                date: '2020-06-20T10:00:00.000Z'
                description: Golden Sun Bakery
                amount: 5.00
                balance: 2082.79
                transactionType: Électronique
                category: Alimentation
                notes: ''
        '401':
          description: Non autorisé - Token d'authentification invalide ou manquant
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Interdit - L'utilisateur n'a pas accès à cette transaction
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Non trouvé - La transaction n'existe pas
          schema:
            $ref: '#/definitions/Error'
          examples:
            application/json:
              status: 404
              message: Transaction non trouvée
        '500':
          description: Erreur interne du serveur
          schema:
            $ref: '#/definitions/Error'
    patch:
      security:
        - Bearer: []
      tags:
        - Module Transactions
      summary: Mettre à jour les informations de la transaction
      description: |
        Met à jour les informations modifiables par l'utilisateur d'une transaction. Seuls les champs catégorie et notes peuvent être modifiés par les utilisateurs. Ce endpoint utilise PATCH pour permettre les mises à jour partielles - vous devez envoyer uniquement les champs que vous souhaitez mettre à jour.
        
        **Cas d'usage** : Permettre aux utilisateurs de catégoriser leurs transactions et d'ajouter des notes personnelles pour un meilleur suivi des dépenses et une meilleure organisation.
        
        **Règles métier** :
        - Seuls catégorie et notes peuvent être modifiés
        - Le montant, la date, la description de la transaction ne peuvent pas être changés
        - La catégorie doit être de la liste prédéfinie ou des catégories personnalisées
        - Les notes ont une limite de longueur maximale
        - Seul le propriétaire du compte peut modifier les transactions
      parameters:
        - in: header
          name: Authorization
          description: Token Bearer JWT pour l'authentification
          required: true
          type: string
        - in: path
          name: transactionId
          description: Identifiant unique de la transaction à mettre à jour
          required: true
          type: string
        - in: body
          name: body
          description: Champs de transaction à mettre à jour (seuls catégorie et notes sont modifiables)
          required: true
          schema:
            $ref: '#/definitions/TransactionUpdate'
      produces:
        - application/json
      responses:
        '200':
          description: Transaction mise à jour avec succès
          schema:
            type: object
            properties:
              status:
                type: integer
                example: 200
              message:
                type: string
                example: Transaction mise à jour avec succès
              body:
                $ref: '#/definitions/TransactionDetails'
          examples:
            application/json:
              status: 200
              message: Transaction mise à jour avec succès
              body:
                transactionId: '63f8c9a5d123456789abcdef'
                accountId: '63f8b8e4d123456789abcdef'
                date: '2020-06-20T10:00:00.000Z'
                description: Golden Sun Bakery
                amount: 5.00
                balance: 2082.79
                transactionType: Électronique
                category: Alimentation
                notes: Petit-déjeuner de réunion avec client
        '400':
          description: Requête incorrecte - Données invalides (ex. catégorie non dans la liste autorisée, notes trop longues)
          schema:
            $ref: '#/definitions/Error'
          examples:
            application/json:
              status: 400
              message: La catégorie doit être l'une des valeurs autorisées
        '401':
          description: Non autorisé - Token d'authentification invalide ou manquant
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Interdit - L'utilisateur n'a pas la permission de modifier cette transaction
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: Non trouvé - La transaction n'existe pas
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Erreur interne du serveur
          schema:
            $ref: '#/definitions/Error'
    delete:
      security:
        - Bearer: []
      tags:
        - Module Transactions
      summary: Supprimer une transaction
      description: |
        Supprime une transaction du compte de l'utilisateur. Ce endpoint est inclus pour l'exhaustivité mais peut avoir un usage restreint selon les règles métier.
        
        **Cas d'usage** : Permettre aux utilisateurs de supprimer des transactions en double ou erronées (si les règles métier le permettent).
        
        **Règles métier** :
        - La plupart des transactions ne peuvent pas être supprimées car elles représentent une activité bancaire réelle
        - Seuls certains types de transactions peuvent être supprimables (ex. notes ajoutées manuellement, transactions en attente)
        - La suppression peut être "soft delete" (marquée comme supprimée mais conservée en base de données)
        - Vérification du propriétaire du compte requise
        - Certaines transactions peuvent être verrouillées et ne peuvent pas être supprimées
        
        **Note** : Consultez les parties prenantes métier pour déterminer la politique de suppression exacte.
      parameters:
        - in: header
          name: Authorization
          description: Token Bearer JWT pour l'authentification
          required: true
          type: string
        - in: path
          name: transactionId
          description: Identifiant unique de la transaction à supprimer
          required: true
          type: string
      produces:
        - application/json
      responses:
        '200':
          description: Transaction supprimée avec succès
          schema:
            type: object
            properties:
              status:
                type: integer
                example: 200
              message:
                type: string
                example: Transaction supprimée avec succès
          examples:
            application/json:
              status: 200
              message: Transaction supprimée avec succès
        '401':
          description: Non autorisé - Token d'authentification invalide ou manquant
          schema:
            $ref: '#/definitions/Error'
        '403':
          description: Interdit - Cette transaction ne peut pas être supprimée en raison des règles métier ou l'utilisateur n'a pas la permission
          schema:
            $ref: '#/definitions/Error'
          examples:
            application/json:
              status: 403
              message: Cette transaction ne peut pas être supprimée car elle représente une activité bancaire terminée
        '404':
          description: Non trouvé - La transaction n'existe pas
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Erreur interne du serveur
          schema:
            $ref: '#/definitions/Error'
  /user/transactions/categories:
    get:
      security:
        - Bearer: []
      tags:
        - Module Transactions
      summary: Récupérer les catégories de transaction disponibles
      description: |
        Récupère la liste de toutes les catégories de transaction disponibles que les utilisateurs peuvent assigner à leurs transactions. Cela inclut à la fois les catégories système prédéfinies et toutes catégories personnalisées créées par l'utilisateur.
        
        **Cas d'usage** : Peupler le menu déroulant de catégories quand les utilisateurs éditent les catégories de transaction.
        
        **Règles métier** :
        - Retourne à la fois les catégories définies par le système et définies par l'utilisateur
        - Les catégories peuvent être organisées hiérarchiquement (ex. Alimentation > Restaurants, Alimentation > Épicerie)
        - Certaines catégories peuvent être suggérées selon la description de transaction ou le commerçant
      parameters:
        - in: header
          name: Authorization
          description: Token Bearer JWT pour l'authentification
          required: true
          type: string
      produces:
        - application/json
      responses:
        '200':
          description: Catégories récupérées avec succès
          schema:
            type: object
            properties:
              status:
                type: integer
                example: 200
              message:
                type: string
                example: Catégories récupérées avec succès
              body:
                type: array
                items:
                  type: object
                  properties:
                    categoryId:
                      type: string
                      description: Identifiant unique de la catégorie
                    name:
                      type: string
                      description: Nom de la catégorie
                    type:
                      type: string
                      enum:
                        - system
                        - custom
                      description: Si c'est une catégorie système ou définie par l'utilisateur
          examples:
            application/json:
              status: 200
              message: Catégories récupérées avec succès
              body:
                - categoryId: 'cat_001'
                  name: Alimentation
                  type: system
                - categoryId: 'cat_002'
                  name: Transport
                  type: system
                - categoryId: 'cat_003'
                  name: Divertissement
                  type: system
                - categoryId: 'cat_004'
                  name: Shopping
                  type: system
                - categoryId: 'cat_005'
                  name: Santé
                  type: system
                - categoryId: 'cat_006'
                  name: Services publics
                  type: system
                - categoryId: 'cat_custom_001'
                  name: Dépenses professionnelles
                  type: custom
        '401':
          description: Non autorisé - Token d'authentification invalide ou manquant
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: Erreur interne du serveur
          schema:
            $ref: '#/definitions/Error'
securityDefinitions:
  Bearer:
    type: apiKey
    name: Authorization
    in: header
    description: |
      En-tête d'autorisation JWT utilisant le schéma Bearer. 
      
      Entrez 'Bearer' [espace] puis votre token dans le champ de texte ci-dessous.
      
      Exemple : "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
definitions:
  User:
    type: object
    properties:
      email:
        type: string
        format: email
        description: Adresse email de l'utilisateur
        example: tony@stark.com
      password:
        type: string
        format: password
        description: Mot de passe de l'utilisateur (minimum 8 caractères)
        minLength: 8
        example: password123
      firstName:
        type: string
        description: Prénom de l'utilisateur
        minLength: 1
        maxLength: 50
        example: Tony
      lastName:
        type: string
        description: Nom de famille de l'utilisateur
        minLength: 1
        maxLength: 50
        example: Stark
  Login:
    type: object
    required:
      - email
      - password
    properties:
      email:
        type: string
        format: email
        description: Adresse email de l'utilisateur
        example: tony@stark.com
      password:
        type: string
        format: password
        description: Mot de passe de l'utilisateur
        example: password123
  ApiResponse:
    type: object
    properties:
      status:
        type: integer
        description: Code de statut HTTP
        example: 200
      message:
        type: string
        description: Message de réponse
        example: Opération réussie
      body:
        type: object
        description: Données de réponse
        properties:
          id:
            type: string
            example: 507f1f77bcf86cd799439011
          email:
            type: string
            example: tony@stark.com
  LoginResponse:
    type: object
    properties:
      token:
        type: string
        description: Token d'authentification JWT (valide 24 heures)
        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYzZjhiOGU0ZDEyMzQ1Njc4OWFiY2RlZiIsImlhdCI6MTYxNjIzOTAyMn0.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
  UserProfile:
    type: object
    properties:
      firstName:
        type: string
        description: Prénom de l'utilisateur
        minLength: 1
        maxLength: 50
        example: Tony
      lastName:
        type: string
        description: Nom de famille de l'utilisateur
        minLength: 1
        maxLength: 50
        example: Stark
  Account:
    type: object
    required:
      - accountId
      - accountType
      - balance
      - accountNumber
    properties:
      accountId:
        type: string
        description: Identifiant unique du compte
        example: '63f8b8e4d123456789abcdef'
      accountType:
        type: string
        description: Type de compte bancaire
        enum:
          - Checking
          - Savings
          - Credit Card
        example: Checking
      accountName:
        type: string
        description: Nom d'affichage du compte
        example: Argent Bank Compte Courant
      accountNumber:
        type: string
        description: Numéro de compte masqué montrant uniquement les 4 derniers chiffres pour la sécurité
        pattern: '^x\d{4}$'
        example: 'x8349'
      balance:
        type: number
        format: float
        description: Solde actuel du compte dans la devise du compte
        example: 2082.79
      currency:
        type: string
        description: Code devise ISO 4217 à trois lettres
        default: USD
        example: USD
  Transaction:
    type: object
    required:
      - transactionId
      - date
      - description
      - amount
      - balance
      - transactionType
    properties:
      transactionId:
        type: string
        description: Identifiant unique de la transaction
        example: '63f8c9a5d123456789abcdef'
      date:
        type: string
        format: date-time
        description: Date et heure de la transaction au format ISO 8601 (UTC)
        example: '2020-06-20T10:00:00.000Z'
      description:
        type: string
        description: Commerçant ou description de la transaction
        example: Golden Sun Bakery
      amount:
        type: number
        format: float
        description: Montant de la transaction (toujours positif, le type détermine si débit/crédit)
        example: 5.00
      balance:
        type: number
        format: float
        description: Solde du compte après cette transaction
        example: 2082.79
      transactionType:
        type: string
        description: Type de transaction
        example: Électronique
      category:
        type: string
        description: Catégorie de transaction (modifiable par l'utilisateur pour le suivi des dépenses)
        example: Alimentation
      notes:
        type: string
        description: Notes personnelles de l'utilisateur sur la transaction (modifiable par l'utilisateur)
        maxLength: 500
        example: ''
  TransactionDetails:
    type: object
    required:
      - transactionId
      - accountId
      - date
      - description
      - amount
      - balance
      - transactionType
    properties:
      transactionId:
        type: string
        description: Identifiant unique de la transaction
        example: '63f8c9a5d123456789abcdef'
      accountId:
        type: string
        description: ID du compte auquel cette transaction appartient
        example: '63f8b8e4d123456789abcdef'
      date:
        type: string
        format: date-time
        description: Date et heure de la transaction au format ISO 8601 (UTC)
        example: '2020-06-20T10:00:00.000Z'
      description:
        type: string
        description: Commerçant ou description de la transaction
        example: Golden Sun Bakery
      amount:
        type: number
        format: float
        description: Montant de la transaction (toujours positif, le type détermine si débit/crédit)
        example: 5.00
      balance:
        type: number
        format: float
        description: Solde du compte après cette transaction
        example: 2082.79
      transactionType:
        type: string
        description: Type de transaction (ex. Électronique, Chèque, GAB, Virement)
        example: Électronique
      category:
        type: string
        description: Catégorie de transaction (modifiable par l'utilisateur pour le suivi des dépenses)
        example: Alimentation
      notes:
        type: string
        description: Notes personnelles de l'utilisateur sur la transaction (modifiable par l'utilisateur)
        maxLength: 500
        example: ''
  TransactionUpdate:
    type: object
    description: Champs qui peuvent être mis à jour par l'utilisateur. Au moins un champ doit être fourni.
    minProperties: 1
    properties:
      category:
        type: string
        description: Nouvelle catégorie pour la transaction (doit être parmi les catégories disponibles)
        example: Alimentation
      notes:
        type: string
        description: Nouvelles notes pour la transaction
        maxLength: 500
        example: Petit-déjeuner de réunion avec client
  Error:
    type: object
    properties:
      status:
        type: integer
        description: Code de statut HTTP
        example: 400
      message:
        type: string
        description: Message d'erreur décrivant ce qui s'est mal passé
        example: Paramètres de requête invalides